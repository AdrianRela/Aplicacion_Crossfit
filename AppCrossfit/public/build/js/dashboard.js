var celdaSeleccionada=null,contSemanasPost=7,contSemanasAnt=7;let thId="";function iniciarAppCrossfit(){CambiarContenedor(),marcarTabsActual(),consultaAPIHorarios(),botonReserva(),diaActual(CalculaInicioSemana()),quitarAlerta(),consultaAPIReservas(CalculaInicioSemana())}function CambiarContenedor(){try{var e=document.querySelector(".contenedor-app");null!==e&&(e.classList.remove("contenedor-app"),e.classList.add("contenedor-app2"))}catch(e){console.error("Error al cambiar el contenedor:",e)}}function marcarTabsActual(){const e=window.location.href,t=document.querySelectorAll(".tabs a");for(let a=0;a<t.length;a++){let n=t[a];e===n.getAttribute("href")&&n.classList.add("actual")}}async function consultaAPIHorarios(){try{const e="/AppCrossfit/api/horarios",t=await fetch(e);mostrarHorarios(await t.json())}catch(e){console.log(e)}}function mostrarHorarios(e){for(var t=document.querySelector("#horarios"),a=[],n=0;n<e.length;n++){var o=e[n];a.includes(o.Hora)||a.push(o.Hora)}a.sort();for(n=0;n<a.length;n++){var c=a[n],r=t.insertRow();r.insertCell().textContent=c;for(var i=["LUNES","MARTES","MIERCOLES","JUEVES","VIERNES","SÁBADO","DOMINGO"],s=0;s<i.length;s++){var l=i[s],d=r.insertCell(),u=e.filter((function(e){return e.Hora===c&&e.Dia.toUpperCase()==l}));if(u.length>0)if(u.length>1){var m=document.createElement("div"),f=document.createElement("div");m.textContent=u[0].nombre,m.className=u[0].nombre,m.id="id-"+u[0].id_clase,f.textContent=u[1].nombre,f.className=u[1].nombre,f.id="id-"+u[1].id_clase,m.setAttribute("onclick","seleccionarCelda(this)"),f.setAttribute("onclick","seleccionarCelda(this)"),d.appendChild(m),d.appendChild(f)}else{(m=document.createElement("div")).className=u[0].nombre,m.textContent=u[0].nombre,m.id="id-"+u[0].id_clase,m.setAttribute("onclick","seleccionarCelda(this)"),d.appendChild(m),d.className="unContenido"}}}}function seleccionarCelda(e){if(e.classList.contains("seleccionada"))e.classList.remove("seleccionada");else if(""!==e.textContent){celdaSeleccionada&&celdaSeleccionada.classList.remove("seleccionada"),(celdaSeleccionada=e).classList.add("seleccionada");const t=e.parentElement,a=Array.from(t.parentNode.children).indexOf(t),n=e.closest("table").querySelector("tr:first-child th:nth-child("+(a+1)+")");n&&(thId=n.id)}}function enviarReservaClase(){const e=document.querySelector(".boton-reservar");var t=document.createElement("input");t.type="hidden",t.name="id_clase",t.value=null==celdaSeleccionada?"":celdaSeleccionada.id;var a=document.createElement("input");a.type="hidden",a.name="fecha_actividad",a.value=thId,e.append(t,a),e.submit()}function botonReserva(){const e=document.getElementById("reserva");e&&e.addEventListener("click",(function(){enviarReservaClase()}))}function diaActual(e){var t=new Date,a=t.getDate().toString().padStart(2,"0")+"/"+(t.getMonth()+1).toString().padStart(2,"0")+"/"+t.getFullYear(),n={weekday:"long"},o=document.getElementById("horarios");if(o){var c=o.querySelectorAll("th");let t=0;c.forEach((function(o){if("#"!=c[t].textContent){var r=e.toLocaleDateString(void 0,n).toLocaleLowerCase().toUpperCase(),i=e.getDate().toString().padStart(2,"0")+"/"+(e.getMonth()+1).toString().padStart(2,"0")+"/"+e.getFullYear();c[t].textContent="";var s=document.createElement("div"),l=document.createElement("div");s.textContent=r,l.textContent=i,c[t].appendChild(s),c[t].appendChild(l),c[t].id=i,i==a&&c[t].setAttribute("class","diaActual"),e.setDate(e.getDate()+1)}t++}))}}function CalculaInicioSemana(){var e=new Date,t=e.getDay();return 1!==t&&e.setDate(e.getDate()-(t-1)),e}function siguienteSemana(){let e=CalculaInicioSemana();if(e.setDate(e.getDate()+contSemanasPost),diaActual(new Date(e.getTime())),consultaAPIReservas(e),console.log("entra"),contSemanasAnt-=7,14==(contSemanasPost+=7)){document.querySelector(".diaActual").classList.remove("diaActual")}borrarSeleccion()}function anteriorSemana(){let e=CalculaInicioSemana();if(e.setDate(e.getDate()-contSemanasAnt),diaActual(new Date(e.getTime())),consultaAPIReservas(e),contSemanasPost-=7,14==(contSemanasAnt+=7)){document.querySelector(".diaActual").classList.remove("diaActual")}borrarSeleccion()}async function consultaAPIReservas(e){try{const t="/AppCrossfit/api/reservas",a=await fetch(t);mostrarReservas(await a.json(),e).then((function(e){actualizarContadores(e)})).catch((function(e){console.error("Error en mostrarReservas:",e)}))}catch(e){console.log(e)}}function mostrarReservas(e,t){return new Promise((function(a,n){var o={},c=new Date(t);c.setDate(c.getDate()+6),c.setHours(0,0,0,0),t.setHours(0,0,0,0);for(var r=0;r<e.length;r++){var i=(s=e[r]).id_clase;o[i]=0}for(r=0;r<e.length;r++){i=(s=e[r]).id_clase;var s,l=new Date(s.fecha_actividad);l.setHours(0,0,0,0),l<=c&&l>=t&&o[i]++}setTimeout((function(){a(o)}),2e3)}))}function actualizarContadores(e){for(let t in e){const a=document.querySelector("#id-"+t);let n=a.textContent;e[t]>0?a.textContent=n+" "+e[t]+"/15":a.textContent=a.className}}function borrarSeleccion(){document.querySelector("#horarios").querySelectorAll("td div").forEach((function(e){e.classList.contains("seleccionada")&&e.classList.remove("seleccionada")})),thId="",celdaSeleccionada=null}function quitarAlerta(){const e=document.querySelector(".alerta");e&&setTimeout(()=>{e.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarAppCrossfit()}));